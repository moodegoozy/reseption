# نظام لوحة تقارير الشفتات

منظومة متكاملة لجمع تقارير الشفتات اليومية مبنية على **React + TypeScript** للواجهة، مع خادم **Node.js** بسيط
لإدارة تسجيل الدخول، حفظ التقارير، وتوليد تقرير يومي تلقائي يتم إرساله بالبريد الإلكتروني الساعة 1 صباحاً.

## المزايا الرئيسية

- **تسجيل دخول للموظفين والمدير** مع صلاحيات مختلفة.
- **نموذج إدخال مبسط** لبيانات الشفت (المهام، البلاغات، ملاحظات التسليم، تقييم الإنتاجية).
- **تخزين مركزي للتقارير** مع إمكانية التعديل (إعادة إرسال نفس الشفت تستبدل التقرير السابق) أو الحذف (للمدير).
- **ملخص يومي آلي** يعرض عدد الشفتات ومتوسط الإنتاجية والملاحظات لكل موظف.
- **تصدير يدوي لملف Excel** أو إرسال الملف بالبريد إلى `moode434@gmail.com` في نهاية اليوم (1 صباحاً).
- **زر يدوي** للمدير لإرسال التقرير فوراً بالإضافة إلى الجدولة الآلية.

## المتطلبات

- Node.js إصدار 18 أو أحدث.
- إعدادات SMTP صالحة لإرسال البريد (يمكن استخدام مزود الشركة أو خدمة خارجية مثل SendGrid أو Gmail).

## إعداد المشروع

1. ثبّت الحزم الخاصة بالواجهة:
   ```bash
   npm install
   ```

2. ثبّت الحزم الخاصة بالخادم:
   ```bash
   cd server
   npm install
   cd ..
   ```

3. أنشئ ملف بيئة للخادم `server/.env` وحدد بيانات SMTP (مثال باستخدام Gmail):
   ```env
   SMTP_HOST=smtp.gmail.com
   SMTP_PORT=465
   SMTP_USER=example@gmail.com
   SMTP_PASS=app-password
   SMTP_FROM=example@gmail.com # اختياري، وإلا يستخدم SMTP_USER
   SUMMARY_RECIPIENT=moode434@gmail.com # اختياري، يرسل افتراضياً لهذا البريد
   ```

   > في حال عدم ضبط بيانات SMTP سيقوم الخادم بحفظ ملف Excel داخل مجلد `server/data` بدلاً من الإرسال.

4. شغّل الخادم (المنفذ الافتراضي 4000):
   ```bash
   cd server
   npm start
   ```

5. في نافذة طرفية أخرى شغّل الواجهة:
   ```bash
   npm run dev
   ```

6. افتح المتصفح على العنوان [http://localhost:5173](http://localhost:5173) وابدأ باستخدام النظام.

### تفعيل خدمات Firebase

- تم دمج مفاتيح مشروع Firebase المذكورة لتفعيل التتبع وتحليلات الاستخدام.
- في حال احتجت لتبديل المشروع، حدّث القيم داخل الملف `src/services/firebase.ts`.
- يتم تحميل التهيئة تلقائياً عند تشغيل الواجهة ولا تحتاج لأي خطوات إضافية.

## بيانات الدخول الافتراضية

| الدور | اسم المستخدم | كلمة المرور |
| --- | --- | --- |
| مدير | `manager` | `admin123` |
| موظف 1 | `employee1` | `123456` |
| موظف 2 | `employee2` | `123456` |
| موظف 3 | `employee3` | `123456` |

> يمكنك تعديل الحسابات من خلال الملف `server/data/employees.json` (كلمات المرور مخزنة لأغراض الاختبار فقط).

## كيفية العمل

1. يسجل كل موظف دخوله ويدخل بيانات الشفت الخاصة به بعد الانتهاء.
2. يظهر للمدير والموظفين ملخص يومي للشفتات الخاصة بتاريخ محدد (افتراضياً تاريخ اليوم).
3. يمكن للمدير حذف أي تقرير أو إرسال الملخص عبر البريد في أي وقت.
4. يتم إرسال ملف Excel تلقائياً الساعة 1 صباحاً يحوي جميع تقارير اليوم السابق إلى البريد المحدد.
5. يمكن تنزيل ملف Excel محلياً في أي وقت من الواجهة.

## بنية المجلدات

- `src/App.tsx`: منطق الواجهة، تسجيل الدخول، تحميل البيانات، والتعامل مع API.
- `src/components/`: مكونات الواجهة (نموذج التقرير، ملخص الشفتات، تسجيل الدخول، زر التصدير).
- `src/services/api.ts`: عميل HTTP بسيط للتعامل مع الخادم.
- `src/utils/reportUtils.ts`: تجهيز الملخص وتوليد ملفات Excel على الواجهة.
- `server/index.js`: خادم Express لإدارة الجلسات والتقارير والبريد.
- `server/data/`: ملفات JSON لحفظ الموظفين والتقارير، بالإضافة لحفظ ملفات Excel عند غياب SMTP.

## أوامر مفيدة

| الأمر | الوصف |
| --- | --- |
| `npm run dev` | تشغيل واجهة React في وضع التطوير. |
| `npm run build` | بناء نسخة الإنتاج للواجهة. |
| `cd server && npm start` | تشغيل خادم التقارير. |

## ملاحظات أمان

- يوصى باستبدال كلمات المرور الاختبارية بنظام إدارة مستخدمين حقيقي وتخزين مشفر.
- اضبط متغير `SUMMARY_RECIPIENT` عند الحاجة لإرسال الملخص إلى أكثر من بريد (يمكن فصل العناوين بفاصلة).
- احرص على تشغيل الخادم على بيئة آمنة وتقييد الوصول إلى ملفات البيانات.

